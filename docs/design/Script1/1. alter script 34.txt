
INSERT INTO FORM_LIST(SLNO, FORMS_NAME, INPUT_BY, INPUT_DATETIME, MOD_NO, [STATUS])
VALUES(109,'ReportReportsDDBreakup',substring(suser_name(),charindex('\',suser_name())+1,20),GETDATE(),1,'L');



INSERT INTO MENU_LIST(SLNO, MENU_NAME, INPUT_BY, INPUT_DATETIME, MOD_NO, [STATUS])
VALUES(114,'ReportReportsDDBreakup',substring(suser_name(),charindex('\',suser_name())+1,20),GETDATE(),1,'L');




ALTER VIEW [dbo].[V_ANY_REMINDER]
as
(
	SELECT SLNO,CHECK_NO,cc.AMOUNT,cc.DRAWEE_BANK_CODE,cc.BRANCH_CODE,cc.LOCATION_CODE,SLIP_DATE,DRAWER,DLOCATION_CODE,
		cc.NONZONE_REF,BANK_NAME,BRANCH_NAME,BRANCH_ADD1,BRANCH_ADD2,LOCATION_NAME,
		REF_DATE,(cc.DRAWEE_BANK_CODE+cc.LOCATION_CODE+cc.branch_code) as struniquebranch_code,
		REMINDER_NO,REMINDER_DATE
		FROM CCHECK cc, BANK b,BRANCH br,LOCATION l,NCOLLECTION nc,CCHECKTOTAL ct
		WHERE cc.D_CODE=ct.D_CODE AND ct.[STATUS]='L' 
		AND cc.REMINDER_NO<7
		AND cc.DRAWEE_BANK_CODE=br.BANK_CODE AND cc.BRANCH_CODE=br.BRANCH_CODE
		AND cc.LOCATION_CODE=br.LOCATION_CODE
		AND cc.DRAWEE_BANK_CODE=b.BANK_CODE  
		AND cc.LOCATION_CODE=br.LOCATION_CODE AND 
		cc.LOCATION_CODE=l.LOCATION_CODE AND cc.RTN_STATUS='O' AND 
		cc.NONZONE_REF IS NOT NULL 
		AND cc.NONZONE_REF=nc.NONZONE_REF
)


GO




-- =============================================
-- Author:		Iftekharul Alam Khan Lodi
-- Create date: 24-Mar-12
-- Description:	Get detail to DCollected table
-- =============================================
ALTER PROCEDURE [dbo].[CMS_DCollected_GetDetailList]		
	@DEL_FLAG	int	,
	@AUTH_FLAG	bit,
	@ENTRY_DATE	datetime
AS
BEGIN	
		
	SET NOCOUNT ON;


	IF @AUTH_FLAG=0
		BEGIN						
			SELECT dc.*,'S' = 'U',ds.SCHEDULE_DATE				 
				FROM DCOLLECTED_HIST dc
				INNER JOIN DSCHEDULE_HIST ds
				ON ds.DS_CODE=dc.DS_CODE 
				WHERE dc.IS_AUTH=0
				GROUP BY dc.DS_CODE,dc.TOTAL_NOCHK,dc.TOTAL_CHKAMT,
				dc.TOTAL_CASHAMT,dc.INPUT_BY,dc.INPUT_DATETIME,dc.INPUT_FROM,
				dc.AUTH_BY,dc.AUTH_DATETIME,dc.AUTH_FROM,
				dc.MOD_NO,dc.[STATUS],dc.IS_AUTH,dc.ENTRY_DATE,ds.SCHEDULE_DATE
				ORDER BY dc.DS_CODE;			
		END;
	ELSE
		BEGIN
			IF @DEL_FLAG=0
				BEGIN
					SELECT dc.*,1 AS 'IS_AUTH','S' = 'A',ds.SCHEDULE_DATE			
						FROM DCOLLECTED dc
						INNER JOIN DSCHEDULE ds
						ON ds.DS_CODE=dc.DS_CODE 
						WHERE dc.[STATUS] ='L'
						AND dc.ENTRY_DATE=@ENTRY_DATE						
						GROUP BY dc.DS_CODE,dc.TOTAL_NOCHK,dc.TOTAL_CHKAMT,
						dc.TOTAL_CASHAMT,dc.INPUT_BY,dc.INPUT_DATETIME,dc.INPUT_FROM,
						dc.AUTH_BY,dc.AUTH_DATETIME,dc.AUTH_FROM,
						dc.MOD_NO,dc.[STATUS],dc.ENTRY_DATE,ds.SCHEDULE_DATE
						ORDER BY dc.DS_CODE;
				END;
			ELSE
				BEGIN
					SELECT dc.*,1 AS 'IS_AUTH','S' = 
						CASE  
							WHEN dc.[STATUS] = 'D' THEN 'D'                    
							ELSE 'A'
						END ,ds.SCHEDULE_DATE
						FROM DCOLLECTED dc
						INNER JOIN DSCHEDULE ds
						ON ds.DS_CODE=dc.DS_CODE
						WHERE dc.[STATUS] IN ('L','D')
						AND ENTRY_DATE=@ENTRY_DATE
						GROUP BY dc.DS_CODE,dc.TOTAL_NOCHK,dc.TOTAL_CHKAMT,
						dc.TOTAL_CASHAMT,dc.INPUT_BY,dc.INPUT_DATETIME,dc.INPUT_FROM,
						dc.AUTH_BY,dc.AUTH_DATETIME,dc.AUTH_FROM,
						dc.MOD_NO,dc.[STATUS],dc.ENTRY_DATE,ds.SCHEDULE_DATE
						ORDER BY dc.DS_CODE;
				END;
		END;	
	   
END

GO


