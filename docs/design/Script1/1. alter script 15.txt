USE [CCMS]
GO




ALTER VIEW [dbo].[V_ANY_FUNDING]
as
(
	SELECT cc.*,nc.AMOUNT as COLLECTED_AMT, nc.VAT, nc.COMMISION, nc.POSTAGE_CHARGE, nc.INSTRUMENT_EXP, 
	cl.ACC_NO,cl.ACC_NAME,cl.MAIL_ADD,cl.CITIANY_CHARGE,cl.CITIANY_STD_CHARGE,cl.CITIANY_VAT,l.LOCATION_NAME,
	b.BANK_NAME AS DRAWEE_BANK,br.BRANCH_NAME as DRAWEE_BRANCH
	FROM CCHECK cc
	INNER JOIN CCHECKTOTAL ct
	ON cc.D_CODE=ct.D_CODE
	INNER JOIN NCOLLECTION nc
	ON nc.NONZONE_REF=cc.NONZONE_REF
	LEFT OUTER JOIN CLIENT cl
	ON cc.CLIENT_CODE=cl.CLIENT_CODE
	LEFT OUTER JOIN LOCATION l
	ON l.LOCATION_CODE=cc.DLOCATION_CODE
	LEFT OUTER JOIN BANK b
	ON b.BANK_CODE=cc.DRAWEE_BANK_CODE
	LEFT OUTER JOIN BRANCH br
	ON br.BRANCH_CODE=cc.BRANCH_CODE AND br.BANK_CODE=cc.DRAWEE_BANK_CODE
	AND br.LOCATION_CODE=cc.LOCATION_CODE
	WHERE cc.RTN_STATUS='P' AND ct.[STATUS]='L'
)

GO



ALTER VIEW [dbo].[V_ANY_OUTSTANDING]
as
(
		SELECT cc.*,
		cl.ACC_NO,cl.ACC_NAME,cl.MAIL_ADD,l.LOCATION_NAME,
		b.BANK_NAME AS DRAWEE_BANK,br.BRANCH_NAME as DRAWEE_BRANCH,DATEDIFF(d,CC.SLIP_DATE,getdate()) as DAYS_OUTSTANDING
		FROM CCHECK cc
		INNER JOIN CCHECKTOTAL ct
		ON ct.D_CODE=cc.D_CODE
		LEFT OUTER JOIN CLIENT cl
		ON cc.CLIENT_CODE=cl.CLIENT_CODE
		LEFT OUTER JOIN LOCATION l
		ON l.LOCATION_CODE=cc.DLOCATION_CODE
		LEFT OUTER JOIN BANK b
		ON b.BANK_CODE=cc.DRAWEE_BANK_CODE
		LEFT OUTER JOIN BRANCH br
		ON br.BRANCH_CODE=cc.BRANCH_CODE AND br.BANK_CODE=cc.DRAWEE_BANK_CODE
		AND br.LOCATION_CODE=cc.LOCATION_CODE
		WHERE NONZONE_REF IS NOT NULL AND cc.RTN_STATUS = 'O' AND ct.[STATUS]='L'
)


GO





ALTER VIEW [dbo].[V_ANY_REMINDER]
as
(
	SELECT SLNO,CHECK_NO,cc.AMOUNT,cc.DRAWEE_BANK_CODE,cc.BRANCH_CODE,cc.LOCATION_CODE,SLIP_DATE,DRAWER,DLOCATION_CODE,
		cc.NONZONE_REF,BANK_NAME,BRANCH_NAME,BRANCH_ADD1,BRANCH_ADD2,LOCATION_NAME,
		REF_DATE,(cc.DRAWEE_BANK_CODE+cc.LOCATION_CODE+cc.branch_code) as struniquebranch_code,
		REMINDER_NO,REMINDER_DATE
		FROM CCHECK cc, BANK b,BRANCH br,LOCATION l,NCOLLECTION nc,CCHECKTOTAL ct
		WHERE cc.D_CODE=ct.D_CODE AND ct.[STATUS]='L' 
		AND cc.DRAWEE_BANK_CODE=br.BANK_CODE AND cc.BRANCH_CODE=br.BRANCH_CODE
		AND cc.LOCATION_CODE=br.LOCATION_CODE
		AND cc.DRAWEE_BANK_CODE=b.BANK_CODE  
		AND cc.LOCATION_CODE=br.LOCATION_CODE AND 
		cc.LOCATION_CODE=l.LOCATION_CODE AND cc.RTN_STATUS='O' AND 
		cc.NONZONE_REF IS NOT NULL 
		AND cc.NONZONE_REF=nc.NONZONE_REF
)



GO





ALTER VIEW [dbo].[V_ANY_RETURN]
as
(
	SELECT cc.*,cl.ACC_NO,cl.ACC_NAME,cl.MAIL_ADD,l.LOCATION_NAME,rr.REJECT_REASON,
		b.BANK_NAME, br.BRANCH_NAME, CONVERT(datetime,CONVERT(varchar(12),nc.INPUT_DATETIME))  AS RET_DATE
		FROM CCHECK cc
		INNER JOIN CCHECKTOTAL ct
		ON cc.D_CODE=ct.D_CODE
		INNER JOIN NCOLLECTION nc
		ON nc.NONZONE_REF=cc.NONZONE_REF
		INNER JOIN RETURN_REJECT rr
		ON cc.RTN_CODE=rr.REJECT_CODE
		LEFT OUTER JOIN CLIENT cl
		ON cc.CLIENT_CODE=cl.CLIENT_CODE
		LEFT OUTER JOIN LOCATION l
		ON l.LOCATION_CODE=cc.DLOCATION_CODE
		LEFT OUTER JOIN BANK b 
		ON b.BANK_CODE=cc.DRAWEE_BANK_CODE
		LEFT OUTER JOIN BRANCH br
		ON b.BANK_CODE=br.BANK_CODE AND br.BRANCH_CODE=cc.BRANCH_CODE
		AND br.LOCATION_CODE=cc.LOCATION_CODE
		WHERE CC.RTN_STATUS='R' AND ct.[STATUS]='L'
)


GO



ALTER VIEW [dbo].[V_DD_FUNDING]
as
(
	SELECT DD.D_CODE AS DEPOSIT_NO, DD.DD_NO, DD.AMOUNT,DD.DD_DATE,
		b.BANK_NAME as DRAWEE_BANK, br.BRANCH_NAME AS DRAWEE_BRANCH ,cc.CLIENT_CODE
		FROM DD 
		INNER JOIN BANK b
		ON b.BANK_CODE=dd.DRAWER_BANKCODE
		INNER JOIN BRANCH br
		ON br.BANK_CODE=dd.DRAWER_BANKCODE AND br.BRANCH_CODE=dd.DRAWER_BRANCHCODE
		AND br.LOCATION_CODE=dd.DRAWER_LOCATION
		INNER JOIN NCOLLECTION nc
		ON DD.D_CODE+RIGHT(('000'+CONVERT(VARCHAR,DD.SLNO)),3) =nc.DDREFNO
		INNER JOIN CCHECK cc
		ON nc.NONZONE_REF=cc.NONZONE_REF
		GROUP BY DD.D_CODE, DD.DD_NO, DD.AMOUNT,DD.DD_DATE,
		b.BANK_NAME, br.BRANCH_NAME,cc.CLIENT_CODE

)


GO








