-- TypeOfEvent
-- ADD, REMOVE, LOGIN, LOGOUT, DELETE, USER LOCKED, LOGIN, UPDATE, AUTHORIZE, EXPIRE

-- Asset
-- SESSION, USER, DEPARTMENT, FUNCTIONAL GROUP, USERS FUNCTIONAL GROUP

SELECT *,'TypeOfEvent' =
CASE WHEN LOG_DESCRIPTION like '%add%' then 'ADD'
WHEN LOG_DESCRIPTION like '%remove%' then 'REMOVE'
WHEN LOG_DESCRIPTION like '%login%' then 'LOGIN'
WHEN LOG_DESCRIPTION like '%logged out%' then 'LOGOUT'
WHEN LOG_DESCRIPTION like '%logout%' then 'LOGOUT'
WHEN LOG_DESCRIPTION like '%delete%' then 'DELETE'
WHEN LOG_DESCRIPTION like '%locked due%' then 'USER LOCKED'
WHEN LOG_DESCRIPTION like '%locked%' then 'LOGIN'
WHEN LOG_DESCRIPTION like '%updated%' then 'UPDATE'
WHEN LOG_DESCRIPTION like '%authorize%' then 'AUTHORIZE'
WHEN LOG_DESCRIPTION like '%expire%' then 'EXPIRE'
ELSE ''
END,
'Asset' =
CASE 
WHEN LOG_DESCRIPTION like '%log%' then 'SESSION'
WHEN LOG_DESCRIPTION like '%locked due%' then 'USER'
WHEN LOG_DESCRIPTION like '%locked%' then 'SESSION'
WHEN LOG_DESCRIPTION like '%department%' then 'DEPARTMENT'
WHEN LOG_DESCRIPTION like '%session%' then 'SESSION'
WHEN LOG_DESCRIPTION like '%roles for user%' then 'USERS FUNCTIONAL GROUP'
WHEN LOG_DESCRIPTION like '%user%' then 'USER'
WHEN LOG_DESCRIPTION like '%Functional Group%' then 'FUNCTIONAL GROUP'
ELSE ''
END,
'SuccessOrFailure' =
CASE 
WHEN LOG_DESCRIPTION like '%login failed%' then 'FAILURE'
ELSE 'SUCCESS'
END,
SUBSTRING(LOG_DESCRIPTION,2,NULLIF(CHARINDEX(']',LOG_DESCRIPTION)-2,-2)) AS HOSTNAME
FROM SYSTEM_LOG
WHERE LOG_DATETIME >= '2015/01/01' and LOG_DATETIME <= '2015/04/01' -- yyyy/mm/dd
ORDER BY LOG_DATETIME 
